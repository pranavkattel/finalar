<html>
  <head>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  </head>
  <body>
    <button id="switchCamera" style="position: absolute; top: 10px; left: 10px; z-index: 1000;">Switch Camera</button>

    <div id="ar-container">
      <a-scene id="scene" mindar-image="imageTargetSrc: data/target2.mind; videoDeviceId: " color-space="sRGB" renderer="colorManagement: true, antialias: false, logarithmicDepthBuffer: true" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
        <a-camera position="0 1.6 0" look-controls></a-camera>
      </a-scene>
    </div>

    <script>
      let currentCameraIndex = 0;
      let cameras = [];

      async function getCameras() {
        const devices = await navigator.mediaDevices.enumerateDevices();
        cameras = devices.filter(device => device.kind === "videoinput");

        // Log camera list in console
        console.log("Available Cameras:");
        cameras.forEach((camera, index) => {
          console.log(`[${index}] ${camera.label || "Unknown Camera"} - ${camera.deviceId}`);
        });

        if (cameras.length > 0) {
          console.log(`Current Camera: ${cameras[currentCameraIndex].label}`);
        }
      }

      async function switchCamera() {
        if (cameras.length < 2) {
          alert("No multiple cameras found!");
          return;
        }

        currentCameraIndex = (currentCameraIndex + 1) % cameras.length;
        const newCameraId = cameras[currentCameraIndex].deviceId;

        console.log(`Switching to Camera [${currentCameraIndex}]: ${cameras[currentCameraIndex].label}`);

        // Destroy the existing MindAR scene
        const oldScene = document.querySelector("#scene");
        oldScene.parentNode.removeChild(oldScene);

        // Create a new MindAR scene with the new camera
        const arContainer = document.querySelector("#ar-container");
        const newScene = document.createElement("a-scene");
        newScene.setAttribute("id", "scene");
        newScene.setAttribute("mindar-image", `imageTargetSrc: data/target2.mind; videoDeviceId: ${newCameraId}`);
        newScene.setAttribute("color-space", "sRGB");
        newScene.setAttribute("renderer", "colorManagement: true, antialias: false, logarithmicDepthBuffer: true");
        newScene.setAttribute("vr-mode-ui", "enabled: false");
        newScene.setAttribute("device-orientation-permission-ui", "enabled: false");

        const camera = document.createElement("a-camera");
        camera.setAttribute("position", "0 1.6 0");
        camera.setAttribute("look-controls", "");

        newScene.appendChild(camera);
        arContainer.appendChild(newScene);
      }

      document.getElementById("switchCamera").addEventListener("click", switchCamera);

      getCameras();
    </script>
  </body>
</html>
